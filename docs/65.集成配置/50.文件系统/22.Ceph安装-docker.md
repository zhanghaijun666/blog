---
title: Ceph 部署
date: 2023-02-20 16:07:59
category: 
  - 集成配置
  - 文件系统
tag: 
  - OSS
  - Ceph
---


<!-- more -->

[[toc]]

## docker 运行 ceph

```bash
# 参考文档：https://www.codenong.com/cs106379205/

#启动mon
docker run -d --net=host  --name=mon \
-v /opt/ceph/etc:/etc/ceph \
-v /opt/ceph/lib/:/var/lib/ceph/ \
-e MON_IP=172.16.10.20 \
-e CEPH_PUBLIC_NETWORK=172.16.10.0/24 \
ceph/daemon:latest-mimic mon

#启动mgr
docker run -d --net=host --name=mgr \
-v /opt/ceph/etc:/etc/ceph  \
-v /opt/ceph/lib/:/var/lib/ceph  \
ceph/daemon:latest-mimic  mgr

#启动osd 1-3
docker run -d --net=host --name=osd1 \
--privileged=true \
-v /opt/ceph/etc:/etc/ceph  \
-v /opt/ceph/lib/:/var/lib/ceph  \
-v /dev/:/dev/ \
-e OSD_DEVICE=/dev/sdb  \
-e OSD_TYPE=disk \
ceph/daemon:latest-mimic osd
docker run -d --net=host --name=osd2 \
--privileged=true \
-v /opt/ceph/etc:/etc/ceph  \
-v /opt/ceph/lib/:/var/lib/ceph  \
-v /dev/:/dev/ \
-e OSD_DEVICE=/dev/sdc  \
-e OSD_TYPE=disk \
ceph/daemon:latest-mimic osd
docker run -d --net=host --name=osd3 \
--privileged=true \
-v /opt/ceph/etc:/etc/ceph  \
-v /opt/ceph/lib/:/var/lib/ceph  \
-v /dev/:/dev/ \
-e OSD_DEVICE=/dev/sdd  \
-e OSD_TYPE=disk \
ceph/daemon:latest-mimic osd

#启动mds
docker run -d --net=host --name=mds \
-v /opt/ceph/etc:/etc/ceph \
-v /opt/ceph/lib/:/var/lib/ceph/ \
-e CEPHFS_CREATE=1 \
ceph/daemon:latest-mimic mds

#配置ceph
docker exec -it mon bash
#执行以下命令
ceph -s
ceph osd pool set cephfs_data pg_num 64
ceph osd pool set cephfs_data pgp_num 64
ceph osd pool set cephfs_metadata pg_num 32
ceph osd pool set cephfs_metadata pgp_num 32
ceph osd pool set cephfs_metadata min_size 1
ceph osd pool set cephfs_data min_size 1

#映射到客户端磁盘目录
#获取口令
cat /opt/ceph/etc/ceph.client.admin.keyring
#基于上面的口令加载磁盘
mount -t ceph 192.168.60.100:6789:/ /data -o name=admin,secret=AQDLp19jQYDUJBAAGgesnbf1D9A2g1FVW0DPSw==
```
