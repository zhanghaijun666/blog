---
title: docker安装
date: 2023-02-20 16:07:59
category: 
  - 容器技术
  - Docker
tag: 
  - Docker
---

<!-- more -->

[[toc]]

## 官网地址

- Docker Hub 的网址：[https://hub.docker.com/](https://hub.docker.com/)
- Docker 镜像仓库：[https://hub.docker.com/](https://hub.docker.com/)

## 在线安装（推荐）

```bash
curl -sSL https://get.daocloud.io/docker | sh
systemctl start docker && systemctl enable docker && systemctl status docker

```

## yum 安装

```bash
## 1. yum安装
# 安装所需环境
yum install -y yum-utils device-mapper-persistent-data lvm2
# 配置yum仓库
# yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo
# 安装Docker
yum install docker-ce
# 启动Docker
systemctl start docker && systemctl enable docker && systemctl status docker


## 2. 官方一键脚本安装
# 安装所需环境
yum install -y yum-utils device-mapper-persistent-data lvm2
# 官方一键脚本安装
curl -fsSL get.docker.com -o get-docker.sh
sh get-docker.sh --mirror Aliyun
# 添加内核参数
tee -a /etc/sysctl.conf <<-EOF
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
# 刷新内核参数
sysctl -p
# 修改Docker仓库为国内镜像站
curl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s https://pclhthp0.mirror.aliyuncs.com
# 启动Docker
systemctl start docker && systemctl enable docker && systemctl status docker
```

## 离线安装

```bash
## 下载地址：   https://download.docker.com/linux/static/stable/x86_64/
## RPM下载地址：https://mirrors.aliyun.com/docker-ce/linux/centos/7/x86_64/stable/Packages/docker-ce-20.10.22-3.el7.x86_64.rpm
# 或者在一台联网的机器上在线下载再拷贝到离线机器上安装docker
yum install -y yum-utils device-mapper-persistent-data lvm2
# 设置yum源
yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
# 查看所有仓库中所有docker版本，并选择特定版本安装
yum list docker-ce --showduplicates | sort -r
# 获取rpm包以及相关依赖
mkdir -p /opt/dockerrpm/ && yum install docker-ce --downloadonly --downloaddir=/opt/dockerrpm/

# 将/opt/dockerrpm/复制到目标机器
rpm -ivhU *.rpm --nodeps --force
systemctl status docker && systemctl enable docker && systemctl status docker
```

## 镜像拉取慢的问题

> Docker Hub 是 docker 默认的公用 Registry，不过缺点是国内下载会比较慢

```bash
cat /etc/docker/daemon.json
cat > /etc/docker/daemon.json <<EOF
{
    "registry-mirrors": [
      "http://hub-mirror.c.163.com",
      "https://docker.mirrors.ustc.edu.cn"
    ],
    "insecure-registries": []
    "max-concurrent-downloads": 3,
    "live-restore": true,
    "max-concurrent-uploads": 5,
    "debug": true,
    "log-opts": {
      "max-size": "10m",
      "max-file": "5"
    }
}
EOF
# 需要重启 docker 服务
systemctl daemon-reload && systemctl restart docker
```

## docker 常见问题

- WARNING: IPv4 forwarding is disabled. Networking will not work.

```bash
# 修改配置文件
# echo "net.ipv4.ip_forward=1" > /etc/sysctl.conf
echo "net.ipv4.ip_forward=1" > /usr/lib/sysctl.d/00-system.conf
# 重启网络和docker
systemctl restart network && systemctl restart docker
# 查看是否修改成功（备注：返回1，就是成功）
sysctl net.ipv4.ip_forward
```

## docker 基本命令

```bash
docker search tomcat		                    # 搜索tomcat镜像
docker pull centos:7		                    # 拉取centos镜像
docker inspect 容器名称或者容器ID           # 查看容器详情
docker ps			                              # 查看正在运行的容器
docker ps -aq                               # 列出所有容器ID
docker ps -a                                # 查看所有运行或者不运行容器
docker ps -l		                            # 查看最近运行过的容器
docker stop $(docker ps -a -q)              # 停止所有的container（容器），这样才能够删除其中的images：
docker stop $(docker ps -aq)
docker rm $(docker ps -a -q)                # 删除所有container（容器）的话再加一个指令
docker rm $(docker ps -aq)
docker images                               # 查看当前有些什么images
docker rmi <image id>                       # 删除images（镜像），通过image的id来指定删除谁
# 删除untagged images，也就是那些id为的image的话可以用
docker rmi $(docker images | grep "^<none>" | awk "{print $3}")
docker rmi $(docker images -q)              # 删除所有镜像
docker rmi -f $(docker images -q)           # 强制删除全部image

docker cp tomcat：/webapps/js/text.js /home/admin  #从容器到宿主机复制
docker cp 容器名:  容器路径             宿主机路径

docker cp /home/admin/text.js tomcat：/webapps/js  #从宿主机到容器复制
docker cp 宿主路径中文件        容器名  容器路径

docker container prune              #删除所有停止的容器
docker image prune --force --all    #删除所有不使用的镜像
docker image prune -f -a

docker stop Name或者ID              #停止一个容器
docker start Name或者ID             #启动一个容器
docker kill Name或者ID              #杀死一个容器
docker restart name或者ID           #重启一个容器

# 以交互方式运行容器：
docker run -i -t --name 容器名称 repository:tag /bin/bash
docker run -it --name 容器名称 imageID /bin/bash
# 以守护进程方式运行容器：
docker run -di --name 容器名称 repository:tag
docker run -di --name 容器名称 imageID
# 注意：通过 run 创建并进入容器之后，如果使用 exit 命令退出容器，则容器停止。再次进入该容器，先使用 start 启动容器，再使用 exec/attach 命令进入容器

docker exec -it 容器名称或者容器ID /bin/bash	# 进入容器
docker attach 容器名称或者容器ID
# 两者之间的区别：
# attach 进入容器之后，如果使用 exit 退出容器，则容器停止。
# exec 进入容器之后，使用 exit 退出容器，容器依然处于运行状态。
```
