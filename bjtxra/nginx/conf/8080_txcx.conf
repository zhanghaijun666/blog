upstream txcx_swarm_ty {
    server 192.168.20.3:8801 weight=1 fail_timeout=20 max_fails=3;
    server 192.168.20.4:8801 weight=1 fail_timeout=20 max_fails=3;
    server 192.168.20.5:8801 weight=1 fail_timeout=20 max_fails=3;
}
server {
    listen 8080;
    server_name  _;

    charset utf-8;

    client_max_body_size        60M;
    client_body_buffer_size     128k;

    proxy_connect_timeout       60s;
    proxy_send_timeout          90;
    proxy_read_timeout          60s;
    proxy_buffer_size           4k;
    proxy_buffers               4 32k;
    proxy_busy_buffers_size     64k;
    proxy_temp_file_write_size  64k;
    proxy_buffering             off;

    gzip                        on;
    gzip_min_length             1m;
    gzip_buffers                4 16k;
    gzip_http_version           1.0;
    gzip_comp_level             6;
    gzip_types                  text/plain application/javascript application/xml application/cc-directory application/json;
    gzip_vary                   on;
    gzip_disable                "MSIE [1-6]\.";

    proxy_set_header   Host             $host;
    proxy_set_header   X-Real-IP        $remote_addr;
    proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
    proxy_set_header   REMOTE-HOST      $remote_addr;

    root /usr/share/nginx/html;
    index index.html index.htm;

    location / {
        rewrite ^/(.*)$  /210/$1 last;
    }

    location ^~/210 {
        rewrite ^/210/(.*)$ /$1 break;
        proxy_pass  http://192.168.20.210;
    }

    location ^~/swarm {
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        rewrite ^/swarm/(.*)$ /$1 break;
        proxy_pass  http://txcx_swarm_ty;
    }

    error_page   404              /404.html;
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
    }
}